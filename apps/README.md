# Streamlit Apps

Interactive Streamlit dashboards for Singapore housing market analysis.

## Overview

This directory contains Streamlit applications that provide interactive visualizations and analytics for Singapore housing data.

## Applications

### 1. Market Overview (`1_market_overview.py`)
**Key statistics and market summary**
- Total transactions, average prices
- Market trends overview
- Property type distribution
- Regional summary statistics

### 2. Price Map (`2_price_map.py`)
**Interactive map with heatmap and scatter views**
- Geographic visualization of property prices
- H3 hexagon grid heatmaps
- Amenity overlays (MRT stations, malls, schools)
- Filters by property type, price range, time period
- Multiple visualization modes (heatmap, scatter, clusters)

### 3. Trends Analytics (`3_trends_analytics.py`)
**Time-series analysis and comparisons**
- Price trends over time
- Market comparisons (regions, property types)
- Correlation analysis
- Seasonal patterns
- Moving averages and trend lines

### 4. Market Insights (`market_insights/`)
**Advanced analytics features**

#### 4a. Market Segments (`4a_segments.py`)
- Property type segmentation
- Price tier analysis
- Cluster profiles

#### 4b. Tier Analysis (`4b_tier_analysis.py`)
- Luxury vs mass market analysis
- Price tier distributions
- Tier-specific trends

#### 4c. Town Leaderboard (`4c_town_leaderboard.py`)
- Town rankings by various metrics
- Performance comparison
- Top/bottom performers

## Quick Start

### Installation

All dependencies are already installed via `uv`. No additional setup needed.

### Running the Apps

**Individual Apps:**
```bash
# Market Overview
uv run streamlit run apps/1_market_overview.py

# Price Map
uv run streamlit run apps/2_price_map.py

# Trends Analytics
uv run streamlit run apps/3_trends_analytics.py

# Market Insights (example)
uv run streamlit run apps/market_insights/4a_segments.py
```

**Main Dashboard (All-in-One):**
```bash
# Run the unified Streamlit dashboard
uv run streamlit run streamlit_app.py
```

Access at: http://localhost:8501

## Data Requirements

The apps require the following datasets to be available in `data/`:

### L3 Unified Dataset
- **Path**: `data/pipeline/L3/unified_dataset.parquet`
- **Contents**: Comprehensive dataset with all features
- **Generated by**: `uv run python scripts/create_l3_unified_dataset.py`

### L2 Features
- **Path**: `data/pipeline/L2/`
- **Contents**: Feature-engineered datasets
- **Generated by**: L2 pipeline scripts

### L1 Processed Data
- **Path**: `data/pipeline/L1/`
- **Contents**: Cleaned and geocoded data
- **Generated by**: L1 pipeline scripts

### MRT & Amenities
- **Path**: `data/pipeline/L2/mrt_stations.parquet`
- **Path**: `data/pipeline/L2/amenities_*.parquet`
- **Generated by**: Amenity processing scripts

## Configuration

### Environment Variables

Create a `.env` file in the project root:

```bash
# No API keys required for dashboard
# Apps only read local data files

# Optional: Google Analytics
GOOGLE_ANALYTICS_ID=your_ga_id
```

### App Settings

Each app can be configured via Streamlit's `.streamlit/config.toml`:

```toml
[theme]
primaryColor = "#F63366"
backgroundColor = "#FFFFFF"
secondaryBackgroundColor = "#F0F2F6"
textColor = "#262730"
font = "sans serif"

[client]
showErrorDetails = false
maxUploadSize = 200

[logger]
level = "info"
```

## Features

### Interactive Visualizations
- **Charts**: Plotly interactive charts
- **Maps**: MapLibre GL JS with custom styles
- **Tables**: Sortable, filterable dataframes
- **Filters**: Dynamic filtering options

### Performance Optimizations
- **Caching**: `@st.cache_data` for expensive operations
- **Lazy Loading**: Data loaded on-demand
- **Session State**: Maintains user selections
- **Parallel Processing**: For data aggregations

### User Experience
- **Responsive Design**: Works on desktop and tablet
- **Dark Mode**: Automatic theme detection
- **Export**: Download data as CSV
- **Shareable URLs**: URL parameters for saved views

## Development

### Adding New Apps

1. **Create app file**: `apps/your_app.py`
2. **Use standard imports**:
   ```python
   import sys
   from pathlib import Path
   sys.path.insert(0, str(Path(__file__).parent.parent))

   from core.config import Config
   from core.data_helpers import load_parquet
   import streamlit as st
   import plotly.express as px
   ```

3. **Follow naming convention**: `N_title.py` (N = order number)
4. **Update this README**: Add app description
5. **Test locally**: `uv run streamlit run apps/your_app.py`

### Best Practices

1. **Data Loading**: Use `load_parquet()` with caching
   ```python
   @st.cache_data(ttl=3600)
   def load_data():
       return load_parquet('data/pipeline/L3/unified_dataset.parquet')
   ```

2. **Configuration**: Load from `Config` class
   ```python
   data_dir = Config.DATA_DIR
   ```

3. **Error Handling**: Graceful fallbacks
   ```python
   try:
       data = load_data()
   except FileNotFoundError:
       st.error("Required dataset not found. Run the pipeline first.")
       st.stop()
   ```

4. **Performance**: Limit data sizes for visualizations
   ```python
   # Downsample for plotting
   sample_data = data.sample(n=10000) if len(data) > 10000 else data
   ```

## Troubleshooting

### Common Issues

**"Dataset not found"**
- Solution: Run `uv run python scripts/create_l3_unified_dataset.py`

**"Module not found"**
- Solution: Ensure running from project root with `uv run streamlit run apps/...`

**"Out of memory"**
- Solution: Increase data sampling, reduce cache size, or filter data

**"Map not rendering"**
- Solution: Check MRT data exists, verify coordinate columns

### Debug Mode

Enable detailed logging:

```python
import logging
logging.basicConfig(level=logging.DEBUG)
```

Or in Streamlit:

```bash
uv run streamlit run apps/1_market_overview.py --logger.level=debug
```

## Performance Tips

1. **Use Caching**: Cache expensive computations
2. **Limit Data**: Sample large datasets before visualization
3. **Lazy Load**: Load data only when needed
4. **Avoid Unnecessary Reruns**: Use `st.session_state`
5. **Optimize Maps**: Limit number of map markers, use clustering

## Deployment

### Streamlit Community Cloud

1. **Push code to GitHub**
2. **Connect to Streamlit Cloud**
3. **Set environment variables**
4. **Deploy**

### Self-Hosted

```bash
# Install Streamlit
pip install streamlit

# Run with custom port
streamlit run apps/1_market_overview.py --server.port 8080

# Run with custom address
streamlit run apps/1_market_overview.py --server.address 0.0.0.0
```

## Dependencies

See `pyproject.toml` for full dependency list:

- `streamlit` - Dashboard framework
- `plotly` - Interactive charts
- `pandas` - Data manipulation
- `geopandas` - Spatial data
- `maplibre` - Map rendering

## Related Documentation

- **[Main README](../README.md)** - Project overview
- **[Scripts README](../scripts/README.md)** - Pipeline scripts
- **[Architecture](../docs/architecture.md)** - System design
- **[CLAUDE.md](../CLAUDE.md)** - Development guidelines

## Support

For issues or questions:
1. Check the troubleshooting section above
2. Consult main documentation
3. Check logs in `data/logs/`
4. Review existing GitHub issues

---

**Last Updated**: 2026-01-31
**Maintained By**: Data Team
