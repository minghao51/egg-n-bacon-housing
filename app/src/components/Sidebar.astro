---
import DarkModeToggle from './DarkModeToggle';
import { getCollection } from 'astro:content';

// Get all analytics docs dynamically
const allDocs = await getCollection('analytics');
const analyticsDocs = allDocs
  .filter(doc => doc.data.status !== 'draft')
  .map(doc => ({
    title: doc.data.title || doc.slug,
    slug: doc.slug,
  }))
  .sort((a, b) => a.title.localeCompare(b.title));
---

<aside class="w-64 bg-card border-r border-border fixed h-full overflow-y-auto hidden lg:block z-50">
  <div class="p-6">
    <a href={import.meta.env.BASE_URL} class="block hover:opacity-80 transition-opacity">
      <h2 class="text-xl font-bold text-foreground mb-2">Egg n Bacon Housing</h2>
    </a>
    <p class="text-sm text-muted-foreground">Analytics Dashboard</p>
  </div>

  <nav class="px-4 pb-4">
    <div class="mb-4">
      <DarkModeToggle client:load />
    </div>

    <ul class="space-y-1">
      <li>
        <div class="px-3 mb-2 text-xs font-semibold text-muted-foreground uppercase tracking-wider">
          Dashboard
        </div>
        <a
          href={`${import.meta.env.BASE_URL}dashboard`}
          class="block px-3 py-2 rounded-md text-sm font-medium text-muted-foreground hover:bg-accent hover:text-accent-foreground transition-colors"
        >
          Market Overview
        </a>
        <a
          href={`${import.meta.env.BASE_URL}dashboard/map`}
          class="block px-3 py-2 rounded-md text-sm font-medium text-muted-foreground hover:bg-accent hover:text-accent-foreground transition-colors"
        >
          Price Map
        </a>
        <a
          href={`${import.meta.env.BASE_URL}dashboard/trends`}
          class="block px-3 py-2 rounded-md text-sm font-medium text-muted-foreground hover:bg-accent hover:text-accent-foreground transition-colors"
        >
          Trends Explorer
        </a>
        <a
          href={`${import.meta.env.BASE_URL}dashboard/segments`}
          class="block px-3 py-2 rounded-md text-sm font-medium text-muted-foreground hover:bg-accent hover:text-accent-foreground transition-colors"
        >
          Market Segments
        </a>
        <a
          href={`${import.meta.env.BASE_URL}dashboard/leaderboard`}
          class="block px-3 py-2 rounded-md text-sm font-medium text-muted-foreground hover:bg-accent hover:text-accent-foreground transition-colors"
        >
          Town Leaderboard
        </a>
      </li>
    </ul>

    <div class="mt-6">
      <h3 class="px-3 mb-2 text-xs font-semibold text-muted-foreground uppercase tracking-wider">
        Analytics
      </h3>
      <ul class="space-y-1">
        <li>
          <a
            href={`${import.meta.env.BASE_URL}analytics/`}
            class="block px-3 py-2 rounded-md text-sm font-medium text-muted-foreground hover:bg-accent hover:text-accent-foreground transition-colors"
          >
            Analytics Index
          </a>
        </li>
        {
          analyticsDocs.map((doc) => (
            <li>
              <a
                href={`${import.meta.env.BASE_URL}analytics/${doc.slug}`}
                class="block px-3 py-2 rounded-md text-sm font-medium text-muted-foreground hover:bg-accent hover:text-accent-foreground transition-colors"
              >
                {doc.title}
              </a>
            </li>
          ))
        }
      </ul>
    </div>
  </nav>
</aside>

<style>
  aside {
    scrollbar-width: thin;
    scrollbar-color: hsl(var(--muted)) transparent;
  }

  aside::-webkit-scrollbar {
    width: 6px;
  }

  aside::-webkit-scrollbar-track {
    background: transparent;
  }

  aside::-webkit-scrollbar-thumb {
    background-color: hsl(var(--muted));
    border-radius: 3px;
  }
</style>
